# shopnet-server Web App

## Overview:
At a high level, there are two parts to this web app:
1. A web.py powered backend
   - Handles URL routing
   - Handles the database connection
   - Handles serving static files
   - Provides a REST API at the following endpoints:
	 - /sites/(\d+)
	 - /nodes/(\d+)
	 - /datapoints/
2. A BackboneJS powered single-page web app

## Project Organization:
- app.py
  - main web.py application.
  - to start the backend server, execute `python app.py` from within
    the project directory
- model.py
  - module that defines the functions for dealing with the database
    connection.
- package.json
  - a configuration file for specifying JavaScript build dependencies
    and some JavaScript project metadata
- schema.sql
  - A mysqldump generated SQL file to prepopulate a new development db
    with some basic test data.
- Gruntfile.js
  - The configuration file for the Grunt build task engine/platform
- COPYING.md
  - Licensing and Copyright information
- README.md
  - This readme file
- /static/
  - The directory that the web.py backend serves static files from.
  - This directory is populated by various Grunt tasks
  - If you thing that you need to put something by hand in there, you
    are probably doing something wrong.
- /templates/
  - The directory that the web.py backend looks for HTML view
    templates to serve.
- /docs/
  - Location for annotated JavaScript source code
  - All files in this directory are generated by the 'docs' Grunt
    task.
- /tests/
  - The directory in which the JavaScript unit tests live.
  - These tests can be run with the command `grunt test` command
- /src/
  - The source files for the JavaScript web app.
- /src/less/
  - The LESS CSS files that are compiled to CSS by the Grunt 'less'
    task
- /src/js/lib/
  - Location of JavaScript libraries
- /src/js/models/
  - Location of BackboneJS model definitions
- /src/js/views/
  - Location of BackboneJS view definitions
- /src/js/bootstrap.js
  - A file that bootstraps the JavaScript application to start
  - Also contains any needed global objects

## Build Requirements:
- node.js
- npm
  - sometimes part of node.js, sometimes a standalone package (Depends
    on what Linux/MacOS package manager you are using)
- Grunt

## Steps to Build and Run:
1. Get the latest code with `git pull origin master`
2. Ensure that grunt-cli is installed globally:
   `sudo npm install -g grunt-cli`
   (This will only have to be done once)
3. Install the build dependencies with `npm install` from in the
   project's top level directory (This will only have to be done once)
4. Build the JavaScript web app:
   `grunt`
5. Ensure that MySQL (or MariaDB) is running
6. If needed, import the schema.sql file into your development SQL server.
7. Start the Python backend:
   `python app.py`
8. Point a modern web browser at localhost:8080/

## Deployment Server Requirements
- python >= v2.7.5
- python-webpy (The WebPy framework)
- python-mysqldb (The MySQL/MariaDB Python2 bindings)
- mysql-server (or mariadb-server)
- nginx (or apache)
- mod_wsgi (or apache equivalent)
- git (only needed if that is how you want to get the files onto the
  server)
  
## How Does the Code Work?

### URL Routing
URL routes are done in the usual web.py manner - a regex like string of
a possible URL is paired with a python class. That class then has a
method defined on it that corresponds to each HTTP verb that is
defined for that URL.
If a particular class does not have a method for a particular HTTP
verb defined, the application automagically returns an HTTP error
code.
#### All URL routes and the handling thereof is defined in `app.py`
#### NB: Trailing slashes on URLS are handled in our URL route definitions
#### NB: URLs corresponding to interacting with a single data object
("/sites/(\d+)" for example) use a different class than their "all
objects" counterpart class.

### Database Access
All database access is proctored through the `model` python module
which is defined in `model.py`. Using an instance of the web.db class,
the database can be interacted with in a consistent and clean manner.

### LESS/CSS
I really hate CSS because it a Turing Complete language that has been
unnecessarily crippled by web browsers. LESS is a CSS-like language
that is compiled to "straight CSS" by the Grunt 'less' build task. You
can read more about LESS at http://lesscss.org

### JavaScript
The shopnet-server application uses BackboneJS for a single-page
JS web app that communicates exclusively with the REST API exposed by
the WebPy application.

## Documentation
Annotated JavaScript source code can be found in the /docs
directory. The HTML files contained therein should be opened in a web
browser. They are generated via the Docco program which can be called
by `grunt docs`.

The LESS is not documented, but it very simple and should be able to
be groked by anybody without any strain.

The python server-side app has code comments in its source files, but
no external documentation. If you read this README from the top, you
should already have encountered how the whole thing works at a high
level. 
